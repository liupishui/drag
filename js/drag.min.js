//https://github.com/liupishui/drag
$.fn.extend({ getRotateAngle: function () { var t = $(this).css("transform"), a = 0; if ("none" !== t) { var e = t.split("(")[1].split(")")[0].split(","), s = e[0], i = e[1]; e[2], e[3], Math.sqrt(s * s + i * i); a = Math.round(Math.atan2(i, s) * (180 / Math.PI)) } return a }, getTranformOrigin: function () { var t = $(this).outerWidth(), a = $(this).outerHeight(), e = "cc", s = $(this).css("transformOrigin").split(" "); return parseFloat(s[0]) == t / 2 && parseFloat(s[1]) == a / 2 && (e = "cc"), 0 == parseFloat(s[0]) && 0 == parseFloat(s[1]) && (e = "nw"), parseFloat(s[0]) == t && 0 == parseFloat(s[1]) && (e = "ne"), parseFloat(s[0]) == t && parseFloat(s[1]) == a && (e = "se"), 0 == parseFloat(s[0]) && parseFloat(s[1]) == a && (e = "sw"), e }, setTranformOrigin: function (t) { $(this).getTranformOrigin(), $(this).getRotateAngle(); var a = $(this).position(); "cc" == t && ($(this)[0].style.transformOrigin = "50% 50%"), "nw" == t && ($(this)[0].style.transformOrigin = "0 0"), "ne" == t && ($(this)[0].style.transformOrigin = "100% 0"), "se" == t && ($(this)[0].style.transformOrigin = "100% 100%"), "sw" == t && ($(this)[0].style.transformOrigin = "0 100%"), $(this).css({ left: parseFloat($(this).css("left")) + (a.left - this.position().left), top: parseFloat($(this).css("top")) + (a.top - this.position().top), right: "auto", bottom: "auto" }), "ne" == t && $(this).css({ right: $(".stage").width() - parseFloat(this.css("left")) - $(this).outerWidth(), left: "auto" }), "se" == t && $(this).css({ right: $(".stage").width() - parseFloat(this.css("left")) - $(this).outerWidth(), bottom: $(".stage").height() - parseFloat(this.css("top")) - $(this).outerHeight(), left: "auto", top: "auto" }), "sw" == t && $(this).css({ bottom: $(".stage").height() - parseFloat(this.css("top")) - $(this).outerHeight(), top: "auto" }) }, Drag: function (t) { $(this).mousedown(function (t) { if ($(this).attr("isDrag", 1), $(t.target).hasClass("rotate") || $(t.target).hasClass("top") || $(t.target).hasClass("topright") || $(t.target).hasClass("right") || $(t.target).hasClass("bottomright") || $(t.target).hasClass("bottom") || $(t.target).hasClass("bottomleft") || $(t.target).hasClass("left") || $(t.target).hasClass("topleft")) $(this).attr("isResize", 1); else if (0 != $(this).attr("isDrag")) { var a = parseFloat($(this).css("left")), e = parseFloat($(this).css("top")), s = t; $(this).mousemove(function (t) { $(this).css({ left: a + t.pageX - s.pageX, top: e + t.pageY - s.pageY }) }), $(this).mouseup(function () { $(this).unbind("mousemove"), $(this).attr("drag", 0) }) } }) }, DisDrag: function () { $(this).attr("isDrag", 0), $(this).attr("drag", 0) }, Resize: function (t, a) { t = !!t && $(this).outerHeight() / $(this).outerWidth(); var e = ['<div class="top" data="n"></div>', '<div class= "topright" data="ne"></div>', '<div class="right" data="e"></div>', '<div class="bottomright" data="se"></div>', '<div class="bottom" data="s"></div>', '<div class="bottomleft" data="sw"></div>', '<div class="left" data="w"></div>', '<div class="topleft" data="nw"></div>', '<div class="rotate" data="rotate">旋转</div>', '<div class="topborder" data="n"></div>', '<div class="rightborder" data="e"></div>', '<div class="bottomborder" data="s"></div>', '<div class="leftborder" data="w"></div>'].join(""); $(e).appendTo($(this)), $(this).mouseover(function () { $(this).addClass("mousedown") }), $(this).mouseleave(function () { void 0 !== $(this).attr("Resize") && 0 != $(this).attr("Resize") || $(this).removeClass("mousedown") }), $(this).mousedown(function (e) { var s = $(e.target); if ("nw" == s.attr("data")) { $(this).attr("Resize", 1), $(this).setTranformOrigin("se"); var i = $(this).getRotateAngle(), o = Math.PI / 2 - i / 180 * Math.PI, h = { left: $(".stage").offset().left + parseFloat($(this).css("left")) + $(this).outerWidth(), top: $(".stage").offset().top + $(".stage").outerHeight() - parseFloat($(this).css("bottom")) } } if ("ne" == s.attr("data") || "n" == s.attr("data")) { $(this).attr("Resize", 1), $(this).setTranformOrigin("sw"); o = (i = $(this).getRotateAngle()) / 180 * Math.PI, h = { left: $(".stage").offset().left + parseFloat($(this).css("left")), top: $(".stage").offset().top + $(".stage").outerHeight() - parseFloat($(this).css("bottom")) } } if ("se" == s.attr("data") || "s" == s.attr("data") || "e" == s.attr("data")) { $(this).attr("Resize", 1), $(this).setTranformOrigin("nw"); o = (i = $(this).getRotateAngle()) / 180 * Math.PI, h = { left: $(".stage").offset().left + parseFloat($(this).css("left")), top: $(".stage").offset().top + parseFloat($(this).css("top")) } } if ("sw" == s.attr("data") || "w" == s.attr("data")) { $(this).attr("Resize", 1), $(this).setTranformOrigin("ne"); i = $(this).getRotateAngle(), o = Math.PI / 2 - i / 180 * Math.PI, h = { left: $(".stage").offset().left + parseFloat($(this).css("left")) + $(this).outerWidth(), top: $(".stage").offset().top + parseFloat($(this).css("top")) } } if ("rotate" == s.attr("data")) { $(this).setTranformOrigin("cc"); o = (i = $(this).getRotateAngle()) / 180 * Math.PI, h = { left: $(".stage").offset().left + parseFloat($(this).css("left")) + $(this).outerWidth() / 2, top: $(".stage").offset().top + parseFloat($(this).css("top")) + $(this).outerHeight() / 2 }; $(this).attr("Resize", 1); var r = Math.asin((h.top - e.pageY) / Math.sqrt(Math.pow(e.pageX - h.left, 2) + Math.pow(e.pageY - h.top, 2))) / Math.PI * 180; h.top == e.pageY && h.left < e.pageX && (r = 0), h.top > e.pageY && h.left < e.pageX && (r = r), h.top > e.pageY && h.left == e.pageX && (r = 90), h.top > e.pageY && h.left > e.pageX && (r = 180 - r), h.top == e.pageY && h.left > e.pageX && (r = 180), h.top < e.pageY && h.left > e.pageX && (r = 180 - r), h.top < e.pageY && h.left == e.pageX && (r = 270), h.top < e.pageY && h.left < e.pageX && (r = 360 + r) } var p = e, g = $(this), l = g.outerWidth(), f = g.outerHeight(); $(document).mousemove(function (e) { if ("nw" == s.attr("data")) { var n = ((h.top - e.pageY) / Math.tan(o) + (h.left - e.pageX)) * Math.sin(o), d = ((h.top - e.pageY) * Math.tan(o) - (h.left - e.pageX)) * Math.cos(o); g.css({ width: n, height: t ? n * t : d }) } if ("ne" == s.attr("data")) { n = 0; n = 0 == o ? l + (e.pageX - p.pageX) : ((e.pageX - h.left) / Math.tan(o) - (h.top - e.pageY)) * Math.sin(o); d = ((e.pageX - h.left) * Math.tan(o) - (e.pageY - h.top)) * Math.cos(o); console.log("ne", o), g.css({ width: n, height: t ? n * t : d }) } if ("se" == s.attr("data")) { n = ((e.pageY - h.top) * Math.tan(o) - (h.left - e.pageX)) * Math.cos(o), d = 0; d = 0 == o ? f + (e.pageY - p.pageY) : ((e.pageY - h.top) / Math.tan(o) - (e.pageX - h.left)) * Math.sin(o), g.css({ width: n, height: t ? n * t : d }) } if ("sw" == s.attr("data")) { n = ((h.left - e.pageX) * Math.tan(o) - (e.pageY - h.top)) * Math.cos(o), d = ((h.left - e.pageX) / Math.tan(o) - (h.top - e.pageY)) * Math.sin(o); console.log("sw", o), g.css({ width: n, height: t ? n * t : d }) } if ("n" == s.attr("data")) { d = ((e.pageX - h.left) * Math.tan(o) - (e.pageY - h.top)) * Math.cos(o), n = 0; n = t ? d / t : l, g.css({ width: n, height: d }) } if ("s" == s.attr("data")) { d = 0; d = 0 == o ? f + (e.pageY - p.pageY) : ((e.pageY - h.top) / Math.tan(o) - (e.pageX - h.left)) * Math.sin(o); n = 0; n = t ? d / t : l, g.css({ width: n, height: d }) } if ("w" == s.attr("data")) { n = ((h.left - e.pageX) * Math.tan(o) - (e.pageY - h.top)) * Math.cos(o), d = 0; d = t ? n * t : f, g.css({ width: n, height: d }) } if ("e" == s.attr("data")) { n = ((e.pageY - h.top) * Math.tan(o) - (h.left - e.pageX)) * Math.cos(o), d = 0; d = t ? n * t : f, g.css({ width: n, height: d }) } if ("rotate" == s.attr("data")) { var c = Math.asin((h.top - e.pageY) / Math.sqrt(Math.pow(e.pageX - h.left, 2) + Math.pow(e.pageY - h.top, 2))) / Math.PI * 180; h.top == e.pageY && h.left < e.pageX && (c = 0), h.top > e.pageY && h.left < e.pageX && (c = c), h.top > e.pageY && h.left == e.pageX && (c = 90), h.top > e.pageY && h.left > e.pageX && (c = 180 - c), h.top == e.pageY && h.left > e.pageX && (c = 180), h.top < e.pageY && h.left > e.pageX && (c = 180 - c), h.top < e.pageY && h.left == e.pageX && (c = 270), h.top < e.pageY && h.left < e.pageX && (c = 360 + c); var u = r - c; g[0].style.transform = "rotate(" + (i + u) + "deg)" } a && a.call($(s).parent()) }) }); var s = this; $(document).mouseup(function () { $(document).unbind("mousemove"), $(s).attr("Resize", 0) }) } });